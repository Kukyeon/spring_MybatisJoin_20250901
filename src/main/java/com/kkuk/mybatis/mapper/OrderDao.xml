<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.kkuk.mybatis.dao.OrderDao">
    
    <!-- 모든 주문 리스트 가져오기 -->
    <select id="orderListDao" resultType="com.kkuk.mybatis.dto.OrderDto">
    	SELECT * FROM springdb.order
    </select>
    
    <!-- 모든 회원 리스트 가져오기 -->
    <select id="userListDao" resultType="com.kkuk.mybatis.dto.UserDto">
    	SELECT * FROM springdb.user
    </select>
    
    <!-- 특정 아이디 유저 가져오기 -->
    <select id="userSearchDao" resultType="com.kkuk.mybatis.dto.UserDto">
    	SELECT * FROM springdb.user WHERE userid = #{param1}
    </select>
    
    <!-- 특정 아이디로 특정 유저 세부 정보 가져오기 -->
    <select id="userInfoDao" resultType="com.kkuk.mybatis.dto.UserIdInfoDto">
    	SELECT u.userid, u.username, i.useraddress, i.userphone 
		FROM springdb.user u
		INNER JOIN springdb.userinfo i ON u.userid = i.userid 
		WHERE u.userid = #{param1}
    </select>
    
    <!-- user:userIngo 1:1 관계 매핑 -->
    <resultMap type="com.kkuk.mybatis.dto.UserDto" id="userWithUserInfo">
    	<id property="userid" column="userid"/> <!-- user테이블의 기본키 셋팅 -->
    	<result property="username" column="username" /> <!-- user테이블의 나머지 필드 셋팅 -->
    	
    	<association property="userInfo" javaType="com.kkuk.mybatis.dto.UserInfoDto">
    		<id property="userid" column="userid" />
    		<result property="useraddress" column="useraddress" />
    		<result property="userphone" column="userphone" />
    	</association>
    </resultMap>
    
     <!-- 특정 아이디로 특정 유저 세부 정보 가져오기 -->
    <select id="userInfoMapDao" resultMap="userWithUserInfo">
    	SELECT u.userid, u.username, i.useraddress, i.userphone 
		FROM springdb.user u
		INNER JOIN springdb.userinfo i ON u.userid = i.userid 
		WHERE u.userid = #{param1}
    </select>
    
    <!-- user:order 1:n 관계 매핑 -->
    <resultMap type="com.kkuk.mybatis.dto.UserDto" id="userWithOrder">
    	<id property="userid" column="userid"/> <!-- user테이블의 기본키 셋팅 -->
    	<result property="username" column="username" /> <!-- user테이블의 나머지 필드 셋팅 -->
    	
    	<collection property="orderDtos" ofType="com.kkuk.mybatis.dto.OrderDto">
    		<id property="orderid" column="orderid" /> <!-- order테이블의 기본키 셋팅 -->
    		<result property="ordername" column="ordername" /> <!-- order 테이블의 나머지 필드 셋팅 -->
    		<result property="userid" column="userid" />
    	</collection>
    </resultMap>
    
    <select id="userOrderListDao" resultMap="userWithOrder">
    	SELECT u.userid, u.username, o.orderid, o.ordername
    	 FROM springdb.user u
    	 INNER JOIN springdb.order o ON u.userid = o.userid
    	 WHERE u.userid = #{param1}
    </select>
    
    <select id="AllUserOrderListDao" resultMap="userWithOrder">
   		 SELECT u.userid, u.username, o.orderid, o.ordername
    	 FROM springdb.user u
    	 INNER JOIN springdb.order o ON u.userid = o.userid
    </select>
    
    </mapper>